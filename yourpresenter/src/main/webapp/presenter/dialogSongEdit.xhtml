<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j">

	<rich:popupPanel id="dialogSongEdit" modal="true" autosized="true"
		resizeable="false"
		onmaskclick="#{rich:component('dialogSongEdit')}.hide();"
		domElementAttachment="form"
		onshow="#{rich:element('dialogSongEditForm:dialogSongEditName')}.focus();"	
		>
		
		<h:form id="dialogSongEditForm">
			
			<a4j:outputPanel id="dialogSongEditPanel">
				<!--
				<f:facet name="header">
					<h:outputText value="Add/edit song" />
				</f:facet>
				 <f:facet name="controls">
					<h:outputLink id="linkClose" value="#"
						onclick="#{rich:component('dialogSongEdit')}.hide(); return false;">
                    	X
                	</h:outputLink>
				</f:facet> -->

				<h:panelGrid columns="1" cellspacing="3">
					<rich:messages id="newSongErrors" ajaxRendered="true"/>
					<h:outputLabel for="dialogSongEditName" value="Name: " />
					<h:inputText id="dialogSongEditName"
						value="#{songEditView.song.name}" required="true" />

					<h:outputLabel for="dialogSongText" value="Text: " />
					<h:inputTextarea id="dialogSongText" rows="15" cols="40"
						value="#{songEditView.song.text}" />

					<h:panelGrid columns="2" cellspacing="3">
						<!-- 
							make sure error is displayed and in case no error => hide the popup
							see: http://mkblog.exadel.com/2009/12/richfaces-built-in-client-functions/
							and: http://docs.jboss.org/richfaces/latest_4_0_X/Component_Reference/en-US/html/chap-Component_Reference-Functions.html
							
							moreover, for hotkeys usage since Richfaces 4.1 panel is not rerendered on show =>
							clear entered data on "OK" button click
							TODO: there is still a problem with error messages that are not cleared
							for Richfaces 4.1.1 it should be replaced with rich:hotkey to prevent this problem
						-->
						<a4j:commandButton id="buttonOK" value="OK" action="#{songEditView.update}"
							oncomplete="if (jQuery(#{rich:element('dialogSongEditForm:newSongErrors')}).is(':empty')) { #{rich:component('dialogSongEdit')}.hide(); jQuery(#{rich:element('dialogSongEditForm:dialogSongEditName')}).val(''); jQuery(#{rich:element('dialogSongEditForm:dialogSongText')}).val(''); }; return true; "		
							render="songs" type="submit"/>
						<a4j:commandButton id="buttonCancel" value="Cancel"
							oncomplete="#{rich:component('dialogSongEdit')}.hide(); return false;" />
					</h:panelGrid>
				</h:panelGrid>

			</a4j:outputPanel>
		</h:form>

	</rich:popupPanel>

</ui:composition>